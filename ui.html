<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* Shadcn ìŠ¤íƒ€ì¼ ê¸°ë°˜ CSS */
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
      margin: 0;
      padding: 0;
      background: #ffffff;
      color: #0f172a;
      line-height: 1.5;
    }
    
    .container {
      padding: 16px;
      max-width: 100%;
    }
    
    .header {
      margin-bottom: 20px;
      text-align: center;
    }
    
    .header h1 {
      font-size: 18px;
      font-weight: 600;
      margin: 0 0 4px 0;
      color: #0f172a;
    }
    
    .header p {
      font-size: 14px;
      color: #64748b;
      margin: 0;
    }
    
    .button-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 20px;
    }
    
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      padding: 8px 16px;
      border: 1px solid transparent;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      min-height: 36px;
    }
    
    .btn-primary {
      background: #0f172a;
      color: #ffffff;
      border-color: #0f172a;
    }
    
    .btn-primary:hover {
      background: #1e293b;
      border-color: #1e293b;
    }
    
    .btn-secondary {
      background: #f8fafc;
      color: #0f172a;
      border-color: #e2e8f0;
    }
    
    .btn-secondary:hover {
      background: #f1f5f9;
      border-color: #cbd5e1;
    }
    
    .btn-outline {
      background: transparent;
      color: #0f172a;
      border-color: #e2e8f0;
    }
    
    .btn-outline:hover {
      background: #f8fafc;
      border-color: #cbd5e1;
    }
    
    .card {
      background: #ffffff;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
    }
    
    .card-header {
      margin-bottom: 12px;
    }
    
    .card-title {
      font-size: 14px;
      font-weight: 600;
      margin: 0 0 4px 0;
      color: #0f172a;
    }
    
    .card-description {
      font-size: 12px;
      color: #64748b;
      margin: 0;
    }
    
    .analysis-section {
      margin-bottom: 16px;
    }
    
    .analysis-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid #f1f5f9;
    }
    
    .analysis-item:last-child {
      border-bottom: none;
    }
    
    .analysis-label {
      font-size: 13px;
      color: #64748b;
    }
    
    .analysis-value {
      font-size: 13px;
      font-weight: 500;
      color: #0f172a;
    }
    
    .confidence-bar {
      width: 60px;
      height: 4px;
      background: #e2e8f0;
      border-radius: 2px;
      overflow: hidden;
    }
    
    .confidence-fill {
      height: 100%;
      background: #10b981;
      border-radius: 2px;
      transition: width 0.3s ease;
    }
    
    .suggestions-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .suggestion-item {
      font-size: 12px;
      color: #64748b;
      padding: 4px 0;
      border-left: 2px solid #e2e8f0;
      padding-left: 8px;
      margin-bottom: 4px;
    }
    
    .keyword-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 8px;
    }
    
    .keyword-tag {
      background: #f1f5f9;
      color: #475569;
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 4px;
      border: 1px solid #e2e8f0;
    }
    
    .preview-section {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 16px;
    }
    
    .preview-title {
      font-size: 13px;
      font-weight: 600;
      margin: 0 0 8px 0;
      color: #0f172a;
    }
    
    .preview-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 0;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .preview-item:last-child {
      border-bottom: none;
    }
    
    .preview-before {
      font-size: 12px;
      color: #64748b;
      flex: 1;
    }
    
    .preview-arrow {
      color: #94a3b8;
      margin: 0 8px;
      font-size: 12px;
    }
    
    .preview-after {
      font-size: 12px;
      color: #059669;
      font-weight: 500;
      flex: 1;
      text-align: right;
    }
    
    .pattern-category {
      margin-bottom: 12px;
    }
    
    .pattern-category-title {
      font-size: 12px;
      font-weight: 600;
      color: #374151;
      margin: 0 0 6px 0;
      padding: 4px 8px;
      background: #f3f4f6;
      border-radius: 4px;
      display: inline-block;
    }
    
    .pattern-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 4px 0;
      font-size: 11px;
    }
    
    .pattern-description {
      color: #6b7280;
      font-size: 10px;
      font-style: italic;
    }
    
    .loading {
      display: none;
      text-align: center;
      padding: 20px;
      color: #64748b;
    }
    
    .loading.show {
      display: block;
    }
    
    .spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid #e2e8f0;
      border-radius: 50%;
      border-top-color: #0f172a;
      animation: spin 1s ease-in-out infinite;
      margin-right: 8px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .hidden {
      display: none;
    }
    
    .tone-badge {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 500;
    }
    
    .tone-friendly {
      background: #dcfce7;
      color: #166534;
    }
    
    .tone-professional {
      background: #dbeafe;
      color: #1e40af;
    }
    
    .tone-enthusiastic {
      background: #fef3c7;
      color: #92400e;
    }
    
    .tone-playful {
      background: #f3e8ff;
      color: #7c3aed;
    }
    
    .tone-neutral {
      background: #f1f5f9;
      color: #475569;
    }
    
    /* ëŒê³ ë§Œ ê°€ì´ë“œ ìŠ¤íƒ€ì¼ */
    .dolgo-guide {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border: 1px solid #f59e0b;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 12px;
    }
    
    .dolgo-guide-title {
      font-size: 13px;
      font-weight: 600;
      color: #92400e;
      margin: 0 0 6px 0;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .dolgo-guide-content {
      font-size: 11px;
      color: #92400e;
      line-height: 1.4;
    }
    
    .dolgo-guide-list {
      margin: 6px 0;
      padding-left: 16px;
    }
    
    .dolgo-guide-list li {
      margin-bottom: 2px;
    }
    
    /* Frame ì„ íƒ UI ìŠ¤íƒ€ì¼ */
    .frame-selection {
      margin-bottom: 16px;
    }
    
    .frame-list {
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      background: #f8fafc;
    }
    
    .frame-item {
      display: flex;
      align-items: center;
      padding: 8px 12px;
      border-bottom: 1px solid #e2e8f0;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .frame-item:last-child {
      border-bottom: none;
    }
    
    .frame-item:hover {
      background: #f1f5f9;
    }
    
    .frame-item.selected {
      background: #dbeafe;
      border-left: 3px solid #3b82f6;
    }
    
    .frame-checkbox {
      width: 16px;
      height: 16px;
      accent-color: #3b82f6;
      margin-right: 8px;
    }
    
    .frame-info {
      flex: 1;
    }
    
    .frame-name {
      font-size: 13px;
      font-weight: 500;
      color: #0f172a;
      margin-bottom: 2px;
    }
    
    .frame-text-count {
      font-size: 11px;
      color: #64748b;
    }
    
    .frame-controls {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }
    
    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
    }
    
    .checkbox-group input[type="checkbox"] {
      width: 14px;
      height: 14px;
      accent-color: #10b981;
    }
    
    .no-frames-message {
      text-align: center;
      padding: 20px;
      color: #64748b;
      font-size: 12px;
    }
    
    .btn-success {
      background: #10b981;
      color: #ffffff;
      border-color: #10b981;
    }
    
    .btn-success:hover {
      background: #059669;
      border-color: #059669;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ¯ DOLGO Verbal System</h1>
    </div>
    
    <!-- ëŒê³ ë§Œì˜ ê¸°ë³¸ ìš©ì–´ ì‹œìŠ¤í…œ ê°€ì´ë“œ -->
    <div class="dolgo-guide">
      <div class="dolgo-guide-title">
        ğŸ¢ ëŒê³ ë§Œì˜ ê¸°ë³¸ ìš©ì–´ ì‹œìŠ¤í…œ
      </div>
      <div class="dolgo-guide-content">
        <ul class="dolgo-guide-list">
          <li>ê¸°ë¶€ ê´€ë ¨ ìš©ì–´ í†µì¼ (ë‚˜ëˆ”/í›„ì›/í•¨ê»˜í•˜ê¸° â†’ ê¸°ë¶€)</li>
          <li>ëª¨ê¸ˆê³¼ ì‚¬ì—° ê°œë… êµ¬ë¶„ (ì •ê¸°ëª¨ê¸ˆ/ì¼ì‹œëª¨ê¸ˆ â†’ ì •ê¸°ì‚¬ì—°/ì¼ì‹œì‚¬ì—°)</li>
          <li>ê¸°ë¶€ì¬ë‹¨ ë“± ì „ë¬¸ ìš©ì–´ ì •í™•í•œ ì‚¬ìš©</li>
          <li>ë°°ë¶„ ê´€ë ¨ ìš©ì–´ í†µì¼ (ë‚˜ëˆ” â†’ ë°°ë¶„)</li>
          <li>ê¸°ë¶€ì¬ë‹¨ ìƒì„± ìš©ì–´ í†µì¼ (ì„¤ë¦½ â†’ ê°œì„¤)</li>
          <li>ë©”ì‹œì§€ì™€ ëŒ“ê¸€ ê°œë… êµ¬ë¶„</li>
        </ul>
      </div>
    </div>
    
    <div class="button-group">
      <button id="get-frames-btn" class="btn btn-outline">Frame ëª©ë¡ ê°€ì ¸ì˜¤ê¸°</button>
      <button id="generate-suggestions-btn" class="btn btn-primary">ë³€í™˜ íŒ¨í„´ ë¯¸ë¦¬ë³´ê¸°</button>
      <button id="apply-selected-btn" class="btn btn-success hidden">ì„ íƒëœ í…ìŠ¤íŠ¸ì— ì¹œê·¼í•œ í†¤ ì ìš©í•˜ê¸°</button>
      <button id="convert-all-btn" class="btn btn-outline">ì„ íƒí•œ Frameì˜ í…ìŠ¤íŠ¸ ë³€í™˜</button>
      <button id="cancel-btn" class="btn btn-outline">ë‹«ê¸°</button>
    </div>
    
    <!-- Frame ì„ íƒ ì„¹ì…˜ -->
    <div id="frame-selection" class="frame-selection hidden">
      <div class="card-header">
        <h3 class="card-title">ğŸ“‹ Frame ì„ íƒ</h3>
        <p class="card-description">í…ìŠ¤íŠ¸ë¥¼ ë³€í™˜í•  Frameì„ ì„ íƒí•˜ì„¸ìš”</p>
      </div>
      
      <div class="frame-controls">
        <div class="checkbox-group">
          <input type="checkbox" id="select-all-frames">
          <label for="select-all-frames">ëª¨ë“  Frame ì„ íƒ</label>
        </div>
        <div class="checkbox-group">
          <input type="checkbox" id="select-none-frames">
          <label for="select-none-frames">ì„ íƒ í•´ì œ</label>
        </div>
      </div>
      
      <div id="frame-list" class="frame-list">
        <!-- Frame ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
      </div>
    </div>
    
    <div id="loading" class="loading">
      <div class="spinner"></div>
      í…ìŠ¤íŠ¸ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...
    </div>
    
    <div id="analysis-results" class="hidden">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">ğŸ“Š í†¤ í”„ë¡œíŒŒì¼ ë¶„ì„</h3>
          <p class="card-description">ì„ íƒí•œ í…ìŠ¤íŠ¸ì˜ UX Writing í†¤ì„ ë¶„ì„í–ˆìŠµë‹ˆë‹¤</p>
        </div>
        
        <div id="tone-profile" class="analysis-section">
          <!-- í†¤ í”„ë¡œíŒŒì¼ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
        </div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">ğŸ” ë³€í™˜ ë¯¸ë¦¬ë³´ê¸°</h3>
          <p class="card-description">ì ìš© ê°€ëŠ¥í•œ ë³€í™˜ í•­ëª©ë“¤ì„ í™•ì¸í•˜ì„¸ìš”</p>
        </div>
        
        <div id="preview-section" class="preview-section">
          <div class="preview-title">ë³€í™˜ ì˜ˆì‹œ</div>
          <div id="preview-items">
            <!-- ë¯¸ë¦¬ë³´ê¸° í•­ëª©ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
          </div>
        </div>
      </div>
    </div>
    
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">ğŸ’¡ UX Writing íŒ¨í„´</h3>
        <p class="card-description">ì¹´í…Œê³ ë¦¬ë³„ ë³€í™˜ íŒ¨í„´</p>
      </div>
      
      <div class="pattern-category">
        <div class="pattern-category-title">ëª…ë ¹í˜• â†’ ì œì•ˆí˜•</div>
        <div class="pattern-item">
          <span class="preview-before">í™•ì¸í•´ë³´ì„¸ìš”</span>
          <span class="preview-arrow">â†’</span>
          <span class="preview-after">í™•ì¸í•˜ê¸°</span>
          <span class="pattern-description">ì¹œê·¼í•œ ì–´ì¡°</span>
        </div>
        <div class="pattern-item">
          <span class="preview-before">ì´ìš©í•´ë³´ì„¸ìš”</span>
          <span class="preview-arrow">â†’</span>
          <span class="preview-after">ì´ìš©í•˜ê¸°</span>
          <span class="pattern-description">ê°„ê²°í•œ í‘œí˜„</span>
        </div>
        <div class="pattern-item">
          <span class="preview-before">ì°¸ì—¬í•´ë³´ì„¸ìš”</span>
          <span class="preview-arrow">â†’</span>
          <span class="preview-after">ì°¸ì—¬í•˜ê¸°</span>
          <span class="pattern-description">ì§ì ‘ì  ìœ ë„</span>
        </div>
      </div>
      
      <div class="pattern-category">
        <div class="pattern-category-title">ê²©ì‹ì²´ â†’ ì¹œê·¼ì²´</div>
        <div class="pattern-item">
          <span class="preview-before">ë©ë‹ˆë‹¤</span>
          <span class="preview-arrow">â†’</span>
          <span class="preview-after">ë¼ìš”</span>
          <span class="pattern-description">ì¹œê·¼í•œ í™•ì¸</span>
        </div>
        <div class="pattern-item">
          <span class="preview-before">ì…ë‹ˆë‹¤</span>
          <span class="preview-arrow">â†’</span>
          <span class="preview-after">ì´ì—ìš”</span>
          <span class="pattern-description">ë¶€ë“œëŸ¬ìš´ ì„¤ëª…</span>
        </div>
        <div class="pattern-item">
          <span class="preview-before">ìˆìŠµë‹ˆë‹¤</span>
          <span class="preview-arrow">â†’</span>
          <span class="preview-after">ìˆì–´ìš”</span>
          <span class="pattern-description">ì¹œê·¼í•œ ì•ˆë‚´</span>
        </div>
      </div>
      
      <div class="pattern-category">
        <div class="pattern-category-title">ê²©ì‹ì  í‘œí˜„ â†’ ì¹œê·¼í•œ í‘œí˜„</div>
        <div class="pattern-item">
          <span class="preview-before">í•˜ì‹œë©´</span>
          <span class="preview-arrow">â†’</span>
          <span class="preview-after">í•˜ë©´</span>
          <span class="pattern-description">ê°„ê²°í•œ ì¡°ê±´</span>
        </div>
        <div class="pattern-item">
          <span class="preview-before">í•˜ì‹­ì‹œì˜¤</span>
          <span class="preview-arrow">â†’</span>
          <span class="preview-after">í•´ì£¼ì„¸ìš”</span>
          <span class="pattern-description">ì •ì¤‘í•œ ìš”ì²­</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    // UI ìƒíƒœ ê´€ë¦¬
    let suggestions = [];
    let selectedNodeIds = [];
    let frames = [];
    let selectedFrameIds = [];
    
    // DOM ìš”ì†Œë“¤
    const getFramesBtn = document.getElementById('get-frames-btn');
    const generateSuggestionsBtn = document.getElementById('generate-suggestions-btn');
    const applySelectedBtn = document.getElementById('apply-selected-btn');
    const convertAllBtn = document.getElementById('convert-all-btn');
    const cancelBtn = document.getElementById('cancel-btn');
    const loading = document.getElementById('loading');
    const frameSelection = document.getElementById('frame-selection');
    const frameList = document.getElementById('frame-list');
    const selectAllFramesCheckbox = document.getElementById('select-all-frames');
    const selectNoneFramesCheckbox = document.getElementById('select-none-frames');
    
    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    getFramesBtn.addEventListener('click', () => {
      showLoading();
      parent.postMessage({ pluginMessage: { type: 'get-frames' } }, '*');
    });
    
    generateSuggestionsBtn.addEventListener('click', () => {
      showLoading();
      parent.postMessage({ pluginMessage: { type: 'generate-suggestions' } }, '*');
    });
    
    applySelectedBtn.addEventListener('click', () => {
      const selectedIds = getSelectedNodeIds();
      if (selectedIds.length > 0) {
        parent.postMessage({ 
          pluginMessage: { 
            type: 'apply-selected-suggestions', 
            data: { selectedNodeIds: selectedIds } 
          } 
        }, '*');
      } else {
        alert('ì„ íƒëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.');
      }
    });
    
    convertAllBtn.addEventListener('click', () => {
      const selectedIds = getSelectedFrameIds();
      if (selectedIds.length > 0) {
        parent.postMessage({ 
          pluginMessage: { 
            type: 'convert-all', 
            data: { selectedFrameIds: selectedIds } 
          } 
        }, '*');
      } else {
        alert('ë³€í™˜í•  Frameì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
      }
    });
    
    cancelBtn.addEventListener('click', () => {
      parent.postMessage({ pluginMessage: { type: 'cancel' } }, '*');
    });
    
    // Frame ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
    selectAllFramesCheckbox.addEventListener('change', () => {
      if (selectAllFramesCheckbox.checked) {
        selectAllFrames();
      }
    });
    
    selectNoneFramesCheckbox.addEventListener('change', () => {
      if (selectNoneFramesCheckbox.checked) {
        selectNoFrames();
      }
    });
    
    // ë¡œë”© í‘œì‹œ
    function showLoading() {
      loading.classList.add('show');
      frameSelection.classList.add('hidden');
      applySelectedBtn.classList.add('hidden');
    }
    
    // ë¡œë”© ìˆ¨ê¸°ê¸°
    function hideLoading() {
      loading.classList.remove('show');
    }
    
    // Frame ëª©ë¡ ë Œë”ë§
    function renderFrames(framesData) {
      frames = framesData;
      selectedFrameIds = framesData.map(f => f.id);
      
      frameList.innerHTML = '';
      
      if (framesData.length === 0) {
        frameList.innerHTML = '<div class="no-frames-message">í…ìŠ¤íŠ¸ê°€ í¬í•¨ëœ Frameì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }
      
      framesData.forEach(frame => {
        const frameItem = document.createElement('div');
        frameItem.className = 'frame-item';
        frameItem.dataset.frameId = frame.id;
        
        frameItem.innerHTML = `
          <input type="checkbox" class="frame-checkbox" data-frame-id="${frame.id}" checked>
          <div class="frame-info">
            <div class="frame-name">${frame.name}</div>
            <div class="frame-text-count">í…ìŠ¤íŠ¸ ${frame.textCount}ê°œ</div>
          </div>
        `;
        
        frameList.appendChild(frameItem);
      });
      
      // ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ ì¶”ê°€
      document.querySelectorAll('.frame-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', updateFrameSelection);
      });
      
      updateFrameSelection();
    }
    
    // Frame ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸
    function updateFrameSelection() {
      const selectedCheckboxes = document.querySelectorAll('.frame-checkbox:checked');
      const totalCheckboxes = document.querySelectorAll('.frame-checkbox');
      
      selectedFrameIds = Array.from(selectedCheckboxes).map(checkbox => checkbox.dataset.frameId);
      
      // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
      selectAllFramesCheckbox.checked = selectedCheckboxes.length === totalCheckboxes.length;
      selectNoneFramesCheckbox.checked = selectedCheckboxes.length === 0;
      
      // Frame ì•„ì´í…œ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
      document.querySelectorAll('.frame-item').forEach(item => {
        const checkbox = item.querySelector('.frame-checkbox');
        if (checkbox.checked) {
          item.classList.add('selected');
        } else {
          item.classList.remove('selected');
        }
      });
    }
    
    // ëª¨ë“  Frame ì„ íƒ
    function selectAllFrames() {
      document.querySelectorAll('.frame-checkbox').forEach(checkbox => {
        checkbox.checked = true;
      });
      updateFrameSelection();
    }
    
    // ëª¨ë“  Frame ì„ íƒ í•´ì œ
    function selectNoFrames() {
      document.querySelectorAll('.frame-checkbox').forEach(checkbox => {
        checkbox.checked = false;
      });
      updateFrameSelection();
    }
    
    // ì„ íƒëœ ë…¸ë“œ IDë“¤ ê°€ì ¸ì˜¤ê¸°
    function getSelectedNodeIds() {
      const selectedCheckboxes = document.querySelectorAll('.suggestion-checkbox:checked');
      return Array.from(selectedCheckboxes).map(checkbox => checkbox.dataset.nodeId);
    }
    
    // ì„ íƒëœ Frame IDë“¤ ê°€ì ¸ì˜¤ê¸°
    function getSelectedFrameIds() {
      const selectedCheckboxes = document.querySelectorAll('.frame-checkbox:checked');
      return Array.from(selectedCheckboxes).map(checkbox => checkbox.dataset.frameId);
    }
    
    // í†¤ ë°°ì§€ ìƒì„±
    function createToneBadge(tone) {
      const badge = document.createElement('span');
      badge.className = `tone-badge tone-${tone}`;
      badge.textContent = tone;
      return badge;
    }
    
    // ì‹ ë¢°ë„ ë°” ìƒì„±
    function createConfidenceBar(confidence) {
      const bar = document.createElement('div');
      bar.className = 'confidence-bar';
      
      const fill = document.createElement('div');
      fill.className = 'confidence-fill';
      fill.style.width = `${confidence * 100}%`;
      
      bar.appendChild(fill);
      return bar;
    }
    
    // í†¤ í”„ë¡œíŒŒì¼ ë Œë”ë§
    function renderToneProfile(profiles) {
      toneProfileDiv.innerHTML = '';
      
      if (profiles.length === 0) {
        toneProfileDiv.innerHTML = '<p style="color: #64748b; font-size: 13px;">ë¶„ì„í•  í…ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        return;
      }
      
      profiles.forEach((profile, index) => {
        const profileDiv = document.createElement('div');
        profileDiv.className = 'analysis-section';
        
        if (profiles.length > 1) {
          const title = document.createElement('h4');
          title.style.fontSize = '13px';
          title.style.margin = '0 0 8px 0';
          title.style.color = '#0f172a';
          title.textContent = `í…ìŠ¤íŠ¸ ${index + 1}`;
          profileDiv.appendChild(title);
        }
        
        // ë¬¸ì¥ ìŠ¤íƒ€ì¼
        const sentenceStyleDiv = document.createElement('div');
        sentenceStyleDiv.className = 'analysis-item';
        sentenceStyleDiv.innerHTML = `
          <span class="analysis-label">ë¬¸ì¥ ìŠ¤íƒ€ì¼</span>
          <div style="display: flex; align-items: center; gap: 8px;">
            <span class="analysis-value">${profile.sentenceStyle.type}</span>
            ${createConfidenceBar(profile.sentenceStyle.confidence).outerHTML}
          </div>
        `;
        profileDiv.appendChild(sentenceStyleDiv);
        
        // ê°ì • í†¤
        const emotionDiv = document.createElement('div');
        emotionDiv.className = 'analysis-item';
        emotionDiv.innerHTML = `
          <span class="analysis-label">ê°ì • í†¤</span>
          <div style="display: flex; align-items: center; gap: 8px;">
            ${createToneBadge(profile.emotion.tone).outerHTML}
            ${createConfidenceBar(profile.emotion.confidence).outerHTML}
          </div>
        `;
        profileDiv.appendChild(emotionDiv);
        
        // ì „ì²´ í†¤
        const overallToneDiv = document.createElement('div');
        overallToneDiv.className = 'analysis-item';
        overallToneDiv.innerHTML = `
          <span class="analysis-label">ì „ì²´ í†¤</span>
          <span class="analysis-value">${profile.overallTone}</span>
        `;
        profileDiv.appendChild(overallToneDiv);
        
        // ì ìš© ê°€ëŠ¥í•œ íŒ¨í„´
        if (profile.patterns && profile.patterns.length > 0) {
          const patternsDiv = document.createElement('div');
          patternsDiv.className = 'analysis-item';
          patternsDiv.innerHTML = `
            <span class="analysis-label">ì ìš© ê°€ëŠ¥í•œ íŒ¨í„´</span>
            <span class="analysis-value">${profile.patterns.length}ê°œ</span>
          `;
          profileDiv.appendChild(patternsDiv);
        }
        
        // í‚¤ì›Œë“œ
        if (profile.keywords.keywords.length > 0) {
          const keywordsDiv = document.createElement('div');
          keywordsDiv.className = 'analysis-item';
          keywordsDiv.innerHTML = `
            <span class="analysis-label">ì£¼ìš” í‚¤ì›Œë“œ</span>
            <div class="keyword-tags">
              ${profile.keywords.keywords.slice(0, 5).map(keyword => 
                `<span class="keyword-tag">${keyword}</span>`
              ).join('')}
            </div>
          `;
          profileDiv.appendChild(keywordsDiv);
        }
        
        // ì œì•ˆì‚¬í•­
        if (profile.suggestions.length > 0) {
          const suggestionsDiv = document.createElement('div');
          suggestionsDiv.className = 'analysis-item';
          suggestionsDiv.innerHTML = `
            <span class="analysis-label">ì œì•ˆì‚¬í•­</span>
            <ul class="suggestions-list">
              ${profile.suggestions.map(suggestion => 
                `<li class="suggestion-item">${suggestion}</li>`
              ).join('')}
            </ul>
          `;
          profileDiv.appendChild(suggestionsDiv);
        }
        
        toneProfileDiv.appendChild(profileDiv);
      });
    }
    
    // ë¯¸ë¦¬ë³´ê¸° ë Œë”ë§
    function renderPreview(profiles) {
      previewItemsDiv.innerHTML = '';
      
      if (profiles.length === 0) {
        previewItemsDiv.innerHTML = '<p style="color: #64748b; font-size: 12px;">ë³€í™˜í•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
        return;
      }
      
      // ê¸°ë³¸ ë³€í™˜ ì˜ˆì‹œë“¤
      const defaultConversions = [
        { before: 'í™•ì¸í•´ë³´ì„¸ìš”', after: 'í™•ì¸í•˜ê¸°', description: 'ì¹œê·¼í•œ ì–´ì¡°' },
        { before: 'ì´ìš©í•´ë³´ì„¸ìš”', after: 'ì´ìš©í•˜ê¸°', description: 'ê°„ê²°í•œ í‘œí˜„' },
        { before: 'ì°¸ì—¬í•´ë³´ì„¸ìš”', after: 'ì°¸ì—¬í•˜ê¸°', description: 'ì§ì ‘ì  ìœ ë„' },
        { before: 'ë©ë‹ˆë‹¤', after: 'ë¼ìš”', description: 'ì¹œê·¼í•œ í™•ì¸' },
        { before: 'ì…ë‹ˆë‹¤', after: 'ì´ì—ìš”', description: 'ë¶€ë“œëŸ¬ìš´ ì„¤ëª…' },
        { before: 'ìˆìŠµë‹ˆë‹¤', after: 'ìˆì–´ìš”', description: 'ì¹œê·¼í•œ ì•ˆë‚´' }
      ];
      
      defaultConversions.forEach(conversion => {
        const item = document.createElement('div');
        item.className = 'preview-item';
        item.innerHTML = `
          <span class="preview-before">${conversion.before}</span>
          <span class="preview-arrow">â†’</span>
          <span class="preview-after">${conversion.after}</span>
          <span class="pattern-description">${conversion.description}</span>
        `;
        previewItemsDiv.appendChild(item);
      });
    }
    
    // ë¶„ì„ ê²°ê³¼ ì²˜ë¦¬
    function handleAnalysisResult(profiles) {
      analysisResults = profiles;
      renderToneProfile(profiles);
      renderPreview(profiles);
      
      hideLoading();
      analysisResultsDiv.classList.remove('hidden');
      applyToneBtn.classList.remove('hidden');
    }
    
    // ë©”ì‹œì§€ ìˆ˜ì‹ 
    window.addEventListener('message', (event) => {
      const message = event.data.pluginMessage;
      
      if (message.type === 'frames-result') {
        renderFrames(message.frames);
        hideLoading();
        frameSelection.classList.remove('hidden');
      } else if (message.type === 'suggestions-result') {
        // ë³€í™˜ ì œì•ˆ ì²˜ë¦¬ëŠ” ì¶”í›„ êµ¬í˜„
        hideLoading();
      }
    });
  </script>
</body>
</html>
